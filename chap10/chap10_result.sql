--되새김 문제
-- P 273

-- 사전작업
CREATE TABLE CHAP10HW_EMP AS SELECT * FROM EMP;
CREATE TABLE CHAP10HW_DEPT AS SELECT * FROM DEPT;
CREATE TABLE CHAP10HW_SALGRADE AS SELECT * FROM SALGRADE;

--1번 CHAP10HW_DEPT 테이블에 50, 60, 70, 80번 부서를 등록

INSERT INTO CHAP10HW_DEPT
    VALUES (50, 'ORACLE', 'BUSAN');
INSERT INTO CHAP10HW_DEPT
    VALUES (60, 'SQL', 'ILSAN');
INSERT INTO CHAP10HW_DEPT
    VALUES (70, 'SELECT', 'INCHEON');
INSERT INTO CHAP10HW_DEPT   
    VALUES (80, 'DML', 'BUNDANG');   
    
SELECT * FROM CHAP10HW_DEPT;
    
--2번 CHAP10HW_EMP 테이블에 8명의 사원 정보를 등록
DESC CHAP10HW_EMP;

INSERT INTO CHAP10HW_EMP
    VALUES (7201, 'TEST_USER1', 'MANAGER', 7788, '16/01/02', 4500, NULL, 50);
INSERT INTO CHAP10HW_EMP
    VALUES (7202, 'TEST_USER2', 'CLERK', 7201, '16/02/21', 1800, NULL, 50);
INSERT INTO CHAP10HW_EMP
    VALUES (7203, 'TEST_USER3', 'ANALYST', 7201, '16/04/11', 3400, NULL, 60);
INSERT INTO CHAP10HW_EMP
    VALUES (7204, 'TEST_USER4', 'SALESMAN', 7201, '16/05/31', 2700, 300, 60);    
INSERT INTO CHAP10HW_EMP
    VALUES (7205, 'TEST_USER5', 'CLERK', 7201, '16/07/20', 2600, NULL, 70);
INSERT INTO CHAP10HW_EMP
    VALUES (7206, 'TEST_USER6', 'CLERK', 7201, '16/09/08', 2600, NULL, 70);
INSERT INTO CHAP10HW_EMP
    VALUES (7207, 'TEST_USER7', 'LECTURER', 7201, '16/10/28', 2300, NULL, 80);
INSERT INTO CHAP10HW_EMP
    VALUES (7208, 'TEST_USER8', 'STUDENT', 7201, '18/03/09', 1200, NULL, 80);   
    
SELECT * FROM CHAP10HW_EMP;

--3번 CHAP10HW_EMP에 속한 사원 중 50번 부서에서 근무하는 사원의 평균 급여보다 많이 받는 사원을 70번 부서로 옮기기

UPDATE CHAP10HW_EMP
    SET DEPTNO = 70
    WHERE SAL > (SELECT AVG(SAL) FROM CHAP10HW_EMP WHERE DEPTNO = 50);
    
SELECT * FROM CHAP10HW_EMP WHERE DEPTNO = 70;

--4번 CHAP10HW_EMP에 속한 사원 중 입사일이 가장 빠른 60번 부서 사원보다 늦게 입사한 사원의 급여를 10% 인상하고 80번 부서로 옮기기

UPDATE CHAP10HW_EMP
    SET SAL = SAL * 1.1,
        DEPTNO = 80
    WHERE HIREDATE > (SELECT MIN(HIREDATE) FROM CHAP10HW_EMP WHERE DEPTNO = 60);
    
SELECT * FROM CHAP10HW_EMP WHERE DEPTNO = 80;

--5번 CHAP10HW_EMP에 속한 사원 중 급여 등급이 5인 사원을 삭제하는 구문 작성

DELETE FROM CHAP10HW_EMP
    WHERE EMPNO IN (SELECT E.EMPNO
                        FROM CHAP10HW_EMP E, CHAP10HW_SALGRADE S
                        WHERE E.SAL BETWEEN S.LOSAL AND S.HISAL
                            AND GRADE = 5);
                        
SELECT * FROM CHAP10HW_EMP;

